"use strict";var k=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var O=Object.getOwnPropertyNames;var $=Object.prototype.hasOwnProperty;var V=(n,s)=>{for(var r in s)k(n,r,{get:s[r],enumerable:!0})},j=(n,s,r,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let e of O(s))!$.call(n,e)&&e!==r&&k(n,e,{get:()=>s[e],enumerable:!(t=M(s,e))||t.enumerable});return n};var H=n=>j(k({},"__esModule",{value:!0}),n);var se={};V(se,{default:()=>v});module.exports=H(se);var u=require("obsidian");var p=require("obsidian"),R={bookTemplatePath:"Templates/BookTemplate.md",authorTemplatePath:"Templates/AuthorTemplate.md",seriesTemplatePath:"Templates/SeriesTemplate.md",archiveTemplatePath:"Templates/ArchiveTemplate.md",libraries:[{id:"default",name:"Main Library",booksRoot:"Books",authorsFolder:"Books/Authors",seriesFolder:"Books/Series",archivePath:"Books/Archive/!Archive.md"}],activeLibraryId:"default",defaultCategory:"Fiction",defaultStatus:"",defaultAcquired:"Owned",defaultSource:"Audible",defaultRatingNumber:3,ratingStyle:"classic",allowHalfStars:!0,createSeriesPages:!1,openCreatedFile:!0,overwriteIfExists:!1,tagRulesJson:JSON.stringify({baseTags:["Book","Audible"],categoryTags:{"Adult Fantasy":["Adult","Fantasy","Erotic"]}},null,2)};function b(n){return(n||"").replace(/\\/g,"/").replace(/^\/+/,"").replace(/\/+$/,"").trim()}function J(n){try{let s=JSON.parse(n),r=Array.isArray(s?.baseTags)?s.baseTags.map(String):[],t=s?.categoryTags&&typeof s.categoryTags=="object"?s.categoryTags:{},e={};for(let a of Object.keys(t)){let o=t[a];Array.isArray(o)&&(e[a]=o.map(String))}return{rules:{baseTags:r,categoryTags:e},error:""}}catch(s){return{rules:{baseTags:[],categoryTags:{}},error:s?.message||"Invalid JSON"}}}var T=class extends p.PluginSettingTab{constructor(s,r){super(s,r),this.plugin=r}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Audible Library Creator"});let r=[{key:"paths",label:"Paths & Templates"},{key:"defaults",label:"Defaults"},{key:"features",label:"Features"},{key:"tags",label:"Tags & Category Rules"},{key:"advanced",label:"Advanced / Importers"}],t="paths",e=()=>{s.findAll("div.alc-section").forEach(o=>o.remove());let a=s.createDiv({cls:"alc-section"});t==="paths"&&this.renderPaths(a),t==="defaults"&&this.renderDefaults(a),t==="features"&&this.renderFeatures(a),t==="tags"&&this.renderTags(a),t==="advanced"&&this.renderAdvanced(a)};new p.Setting(s).setName("Settings section").setDesc("Choose which settings group to view.").addDropdown(a=>{for(let o of r)a.addOption(o.key,o.label);a.setValue(t),a.onChange(o=>{t=o,e()})}),e()}renderPaths(s){s.createEl("h3",{text:"Templates"});let r=this.plugin.settings,t=(e,a,o)=>{new p.Setting(s).setName(e).setDesc(a).addText(i=>{i.setPlaceholder("Templates/MyTemplate.md"),i.setValue(String(r[o]||"")),i.onChange(async c=>{this.plugin.settings[o]=b(c),await this.plugin.saveSettings()})})};t("Book template path","Template for book notes.","bookTemplatePath"),t("Author template path","Template for author notes (optional).","authorTemplatePath"),t("Series template path","Template for series notes (optional).","seriesTemplatePath"),t("Archive template path","Template for archive notes (optional).","archiveTemplatePath"),s.createEl("h3",{text:"Libraries"}),s.createEl("p",{text:"Configure separate paths for different categories/genres. Each library has its own folders for books, authors, and series, and its own archive file."}),r.libraries.forEach((e,a)=>{let o=s.createDiv({cls:"alc-library-item"});o.style.border="1px solid var(--background-modifier-border)",o.style.padding="10px",o.style.marginBottom="10px",o.style.borderRadius="8px",new p.Setting(o).setName(`Library: ${e.name}`).addExtraButton(i=>{i.setIcon("trash").setTooltip("Delete this library").onClick(async()=>{if(r.libraries.length<=1){new Notice("You must have at least one library.");return}r.libraries.splice(a,1),r.activeLibraryId===e.id&&(r.activeLibraryId=r.libraries[0].id),await this.plugin.saveSettings(),this.display()})}),new p.Setting(o).setName("Library name").addText(i=>{i.setValue(e.name),i.onChange(async c=>{e.name=c.trim(),await this.plugin.saveSettings()})}),new p.Setting(o).setName("Books root").setDesc("Where book notes are created.").addText(i=>{i.setValue(e.booksRoot),i.onChange(async c=>{e.booksRoot=b(c),await this.plugin.saveSettings()})}),new p.Setting(o).setName("Authors folder").addText(i=>{i.setValue(e.authorsFolder),i.onChange(async c=>{e.authorsFolder=b(c),await this.plugin.saveSettings()})}),new p.Setting(o).setName("Series folder").addText(i=>{i.setValue(e.seriesFolder),i.onChange(async c=>{e.seriesFolder=b(c),await this.plugin.saveSettings()})}),new p.Setting(o).setName("Archive path").setDesc("Path to the archive .md file.").addText(i=>{i.setValue(e.archivePath),i.onChange(async c=>{e.archivePath=b(c),await this.plugin.saveSettings()})})}),new p.Setting(s).addButton(e=>{e.setButtonText("Add Library").setCta().onClick(async()=>{let a="lib-"+Date.now();r.libraries.push({id:a,name:"New Library",booksRoot:"Books/New",authorsFolder:"Books/New/Authors",seriesFolder:"Books/New/Series",archivePath:"Books/New/!Archive.md"}),await this.plugin.saveSettings(),this.display()})})}renderDefaults(s){s.createEl("h3",{text:"Defaults"});let r=this.plugin.settings;new p.Setting(s).setName("Default category").setDesc("Used when category is not provided in the modal.").addText(t=>{t.setValue(r.defaultCategory||""),t.onChange(async e=>{this.plugin.settings.defaultCategory=e.trim(),await this.plugin.saveSettings()})}),new p.Setting(s).setName("Default status").setDesc("Blank by default is recommended for bulk importing.").addText(t=>{t.setValue(r.defaultStatus||""),t.onChange(async e=>{this.plugin.settings.defaultStatus=e.trim(),await this.plugin.saveSettings()})}),new p.Setting(s).setName("Default acquired").setDesc("Example: Owned, Wish Listed.").addText(t=>{t.setValue(r.defaultAcquired||""),t.onChange(async e=>{this.plugin.settings.defaultAcquired=e.trim(),await this.plugin.saveSettings()})}),new p.Setting(s).setName("Default source").setDesc("Example: Audible.").addText(t=>{t.setValue(r.defaultSource||""),t.onChange(async e=>{this.plugin.settings.defaultSource=e.trim(),await this.plugin.saveSettings()})}),s.createEl("h4",{text:"Rating"}),new p.Setting(s).setName("Default rating number").setDesc("Example: 3 or 3.5").addText(t=>{t.setValue(String(r.defaultRatingNumber)),t.onChange(async e=>{let a=Number(e);Number.isFinite(a)&&(this.plugin.settings.defaultRatingNumber=a,await this.plugin.saveSettings())})}),new p.Setting(s).setName("Rating style").setDesc("Emoji stars or classic symbols.").addDropdown(t=>{t.addOption("emoji","Emoji (\u2B50)"),t.addOption("classic","Classic (\u2605)"),t.setValue(r.ratingStyle),t.onChange(async e=>{this.plugin.settings.ratingStyle=e,await this.plugin.saveSettings()})}),new p.Setting(s).setName("Allow half stars").setDesc("If enabled, 3.5 can render as 3 and a half.").addToggle(t=>{t.setValue(r.allowHalfStars),t.onChange(async e=>{this.plugin.settings.allowHalfStars=e,await this.plugin.saveSettings()})})}renderFeatures(s){s.createEl("h3",{text:"Features"});let r=this.plugin.settings;new p.Setting(s).setName("Create series pages").setDesc("Optional, not implemented yet (placeholder).").addToggle(t=>{t.setValue(r.createSeriesPages),t.onChange(async e=>{this.plugin.settings.createSeriesPages=e,await this.plugin.saveSettings()})}),s.createEl("h4",{text:"Creation behavior"}),new p.Setting(s).setName("Open created file automatically").addToggle(t=>{t.setValue(r.openCreatedFile),t.onChange(async e=>{this.plugin.settings.openCreatedFile=e,await this.plugin.saveSettings()})}),new p.Setting(s).setName("Overwrite if exists").setDesc("If a file already exists, replace it.").addToggle(t=>{t.setValue(r.overwriteIfExists),t.onChange(async e=>{this.plugin.settings.overwriteIfExists=e,await this.plugin.saveSettings()})})}renderTags(s){s.createEl("h3",{text:"Tags & Category Rules"});let r=this.plugin.settings,t=J(r.tagRulesJson);t.error&&s.createEl("p",{text:`JSON error: ${t.error}`}),new p.Setting(s).setName("Tag rules (JSON)").setDesc("Controls base tags and per-category tags.").addTextArea(e=>{e.setValue(r.tagRulesJson),e.inputEl.rows=14,e.onChange(async a=>{this.plugin.settings.tagRulesJson=a,await this.plugin.saveSettings()})})}renderAdvanced(s){s.createEl("h3",{text:"Advanced / Importers"}),s.createEl("p",{text:"Coming soon: batch import from library and wishlist pages."})}};function d(n){let s=(n??"").trim();if(!s)return"";try{let r=new URL(s);return r.search="",r.hash="",r.toString()}catch{return s.split("?")[0].split("#")[0]}}function m(n){return(n??"").replace(/\u00A0|\u202F|\u2009/g," ").replace(/\s+/g," ").trim()}function _(n){let s=m(n);return s=s.split(":").join(" - "),s=s.split("&").join(" and "),s=s.replace(/[<>:"/\\|?*\x00-\x1F]/g,""),s=m(s),s=s.replace(/[. ]+$/g,"").trim(),s.length>180&&(s=s.slice(0,180).trim()),s}function F(n){let s=new Set,r=[];for(let t of n){let e=(t??"").trim();e&&(s.has(e)||(s.add(e),r.push(e)))}return r}function C(n){let s=m(n).replace(/&amp;/g,"&");if(!s)return[];let t=s.replace(/\s*(,|\||\/|•|·)\s*/g,",").replace(/\s*&\s*/g," & ").split(",").map(a=>a.trim()).filter(Boolean),e=[];for(let a of t){let o=a.includes(" & ")?a.split(" & ").map(i=>i.trim()).filter(Boolean):[a];for(let i of o){let c=i.replace(/[^\w\s-]/g,"").trim();if(!c)continue;let g=c.split(/\s+/).map(h=>h.charAt(0).toUpperCase()+h.slice(1)).join("");g&&e.push(g)}}return F(e)}function E(n){let s=(n??"").trim();if(!s)return"";let r=s.startsWith("/")?`https://www.audible.com${s}`:s;return d(r)}function I(n){return new DOMParser().parseFromString(n,"text/html")}function W(n){let s=[],r=Array.from(n.querySelectorAll('script[type="application/ld+json"]'));for(let t of r){let e=(t.textContent??"").trim();if(e)try{let a=JSON.parse(e);if(Array.isArray(a))for(let o of a)o&&typeof o=="object"&&s.push(o);else a&&typeof a=="object"&&s.push(a)}catch{}}return s}function z(n){for(let s of n){let r=s?.["@type"];if((Array.isArray(r)?r.map(e=>String(e).toLowerCase()):[String(r??"").toLowerCase()]).some(e=>["book","audiobook","product","creativework"].includes(e)))return s}return n.length?n[0]:null}function G(n,s,r){let t=typeof r?.name=="string"?m(r.name):"",e=typeof r?.url=="string"?d(r.url):"";if(t)return{title:t,url:e||d(s)};let a=n.querySelector('meta[property="og:title"]')?.content??n.querySelector('meta[name="og:title"]')?.content??"";return a?{title:m(a),url:d(s)}:{title:"Unknown Title",url:d(s)}}function K(n,s){let r=s?.image;if(typeof r=="string"&&r.startsWith("http"))return d(r);if(Array.isArray(r)&&typeof r[0]=="string")return d(r[0]);let t=n.querySelector('meta[property="og:image"]')?.content??n.querySelector('meta[name="og:image"]')?.content??"";return t?d(t):""}function Y(n,s){let r=typeof s?.description=="string"?m(s.description):"";if(r)return r;let t=n.querySelector('meta[property="og:description"]')?.content??n.querySelector('meta[name="og:description"]')?.content??"";return t?m(t):""}function L(n){let s=new Set,r=[];for(let t of n){let e=m(t.name);if(!e)continue;let a=e.toLowerCase();s.has(a)||(s.add(a),r.push({name:e,url:d(t.url??"")}))}return r}function Q(n,s){let r=[],t=(l,y)=>{let w=m(l);w&&r.push({name:w,url:d(y??"")})},e=s?.author;if(Array.isArray(e))for(let l of e)typeof l=="string"?t(l):l&&typeof l=="object"&&t(l.name??"",l.url??"");else e&&typeof e=="object"?t(e.name??"",e.url??""):typeof e=="string"&&t(e);let a=L(r);if(!(a.length===0||a.some(l=>!l.url)))return a;let i=[],c=['[data-testid*="byline"]','[class*="byLine"]','[class*="byline"]'];for(let l of c)i.push(...Array.from(n.querySelectorAll(l)));let g=Array.from(n.querySelectorAll("div,span,section"));for(let l of g){let y=l.textContent??"";/(\bBy\b|\bWritten by\b|\bAuthor\b)/i.test(y)&&l.querySelector('a[href*="/author/"]')&&i.push(l)}let h=new Map;for(let l of i){let y=Array.from(l.querySelectorAll('a[href*="/author/"]'));for(let w of y){let S=m(w.textContent??"");S&&h.set(S.toLowerCase(),E(w.getAttribute("href")??""))}}if(a.length)return a=a.map(l=>{if(l.url)return l;let y=h.get(l.name.toLowerCase())??"";return{name:l.name,url:d(y)}}),L(a);let f=[];for(let[l,y]of h.entries()){let w=l.replace(/\b\w/g,S=>S.toUpperCase());f.push({name:w,url:d(y)})}return L(f)}function X(n){let s=o=>{let c=m(o).match(/\bBook\s+(\d+)\b/i);return c?c[1]:""},r=n.querySelector('div[data-testid="line"][data-event-id="series"]')||n.querySelector('div[data-testid="line"][key="series"]');if(!r){let o=Array.from(n.querySelectorAll('div[data-testid="line"]'));for(let i of o){let c=i.querySelector(".label");if(m(c?.textContent??"").toLowerCase()==="series"){r=i;break}}}let t="",e="",a="";if(r){let o=r.querySelector('a.link[href*="/series/"]');o&&(t=m(o.textContent??""),e=E(o.getAttribute("href")??"")),a=s(r.textContent??"")}if(!e){let o=n.querySelector('a[href*="/series/"]');if(o){t=m(o.textContent??""),e=E(o.getAttribute("href")??"");let i=o.parentElement;for(let c=0;c<4&&i&&!a;c++)a=s(i.textContent??""),i=i.parentElement}}if(!(!t||!e))return{name:t,url:d(e),book:a??""}}function Z(n,s){let r=[],t=Array.from(n.querySelectorAll("adbl-chip-group.product-topictag-impression adbl-chip"));for(let i of t){let c=m(i.textContent??"");c&&r.push(...C(c))}let e=n.querySelector('div[data-testid="line"][key="categories"]');if(e){let i=Array.from(e.querySelectorAll("a.link[href]"));for(let c of i){let g=m(c.textContent??"");g&&r.push(...C(g))}}let a=s?.genre;if(typeof a=="string")r.push(...C(a));else if(Array.isArray(a))for(let i of a)typeof i=="string"&&r.push(...C(i));let o=new Set(["audible","audiobooks","audiobook"]);return r=r.filter(i=>i&&!o.has(i.toLowerCase())),F(r)}async function B(n,s){let r=(s??"").trim();if(!r)throw new Error("Template path is empty.");let t=r.replace(/\\/g,"/").replace(/^\/+/,""),e=n.vault.getAbstractFileByPath(t);if(!e||!(e instanceof u.TFile))throw new Error(`Template not found: ${t}`);return await n.vault.read(e)}function q(n,s){let r=n,t=(e,a)=>{r=r.split(e).join(a)};if("title"in s){let e=s,a=e.authors.map(l=>l.name).filter(Boolean).join(", "),o=e.authors.length?e.authors.map(l=>l.url?`[${l.name}](${d(l.url)})`:l.name).join(`,  
`):"_Unknown_",i=e.series?.name??"",c=e.series?e.series.url?`[${e.series.name}](${d(e.series.url)})`:e.series.name:"",g=e.series?.book??"",h=e.tags.map(l=>`#${l}`).join(" "),f="["+e.tags.map(l=>JSON.stringify(l)).join(",")+"]";t("{{title}}",e.title??""),t("{{cover_url}}",d(e.coverUrl??"")),t("{{authors_md}}",o),t("{{authors_plain}}",a),t("{{series_md}}",c),t("{{series_plain}}",i),t("{{book_md}}",g),t("{{tags}}",h),t("{{tags_yaml}}",f),t("{{status}}",e.status??""),t("{{acquired}}",e.acquired??""),t("{{source}}",e.source??"")}else{let e=s;t("{{author_plain}}",e.author),t("{{author_md}}",`[[${e.author}]]`),t("{{image_url}}",d(e.imageUrl??""))}return t("{{type}}",s.type??""),t("{{category}}",s.category??""),t("{{url}}",d(s.url??"")),t("{{description}}",(s.description??"").trim()),t("{{rating}}",s.rating??""),r=r.replace(/\n{4,}/g,`


`),r.trim()+`
`}async function ee(n,s,r,t,e){let o=(await(0,u.requestUrl)({url:n,headers:{"Accept-Language":"en-US,en;q=0.9"}})).text,i=I(o),c=W(i),g=z(c),{title:h,url:f}=G(i,n,g),l=_(h),y=K(i,g),w=Y(i,g),S=Q(i,g),U=X(i),A=[],D=JSON.parse(r.tagRulesJson);A.push(...D.baseTags||[]),A.push(...Z(i,g));let x=D.categoryTags?.[s.name];return x&&Array.isArray(x)&&A.push(...x),A=F(A),{title:l,url:d(f),coverUrl:y,authors:S,series:U,description:w,category:s.name,status:t??r.defaultStatus,acquired:r.defaultAcquired,source:r.defaultSource,rating:e??String(r.defaultRatingNumber),tags:A,type:"book"}}async function te(n,s,r,t){let a=(await(0,u.requestUrl)({url:n,headers:{"Accept-Language":"en-US,en;q=0.9"}})).text,o=I(a),i=o.querySelector("h1")?.textContent?.trim()??"Unknown Author",c=o.querySelector("img.author-profile-picture")?.getAttribute("src")??"";c||(c=o.querySelector("meta[property='og:image']")?.getAttribute("content")??"");let g=o.querySelector(".bc-expander-content")?.textContent?.trim()??o.querySelector(".author-description")?.textContent?.trim()??o.querySelector("#author-biography")?.textContent?.trim()??o.querySelector(".author-biography-text")?.textContent?.trim()??o.querySelector(".a-spacing-small .a-size-medium")?.textContent?.trim()??"";return{author:i,url:d(n),imageUrl:c,category:s.name,rating:t??String(r.defaultRatingNumber),description:g,type:"author"}}var P=class extends u.Modal{constructor(r,t){super(r);this.url="";this.libraryId="";this.status="";this.rating="";this.plugin=t,this.libraryId=t.settings.activeLibraryId,this.status=t.settings.defaultStatus,this.rating=String(t.settings.defaultRatingNumber)}async onOpen(){let{contentEl:r}=this;r.empty(),r.createEl("h2",{text:"Create Book from Audible"}),new u.Setting(r).setName("Audible URL").setDesc("Paste the Audible book page URL (https://www.audible.com/pd/...)").addText(t=>{t.setPlaceholder("https://www.audible.com/pd/...").onChange(e=>this.url=e.trim()),t.inputEl.style.width="100%"}),new u.Setting(r).setName("Library").setDesc("Select the target library for this book.").addDropdown(t=>{this.plugin.settings.libraries.forEach(e=>{t.addOption(e.id,e.name)}),t.setValue(this.libraryId),t.onChange(e=>this.libraryId=e)}),new u.Setting(r).setName("Status").addText(t=>{t.setValue(this.status).onChange(e=>this.status=e.trim()),t.inputEl.style.width="100%"}),new u.Setting(r).setName("Rating").setDesc("Numeric rating (e.g. 3 or 4.5)").addText(t=>{t.setValue(this.rating).onChange(e=>this.rating=e.trim()),t.inputEl.style.width="100%"}),new u.Setting(r).addButton(t=>{t.setButtonText("Create").setCta().onClick(async()=>{try{if(!this.url){new u.Notice("Please enter an Audible URL.");return}let e=this.plugin.settings.libraries.find(a=>a.id===this.libraryId);if(!e){new u.Notice("Selected library not found.");return}this.plugin.settings.activeLibraryId!==this.libraryId&&(this.plugin.settings.activeLibraryId=this.libraryId,await this.plugin.saveSettings()),await this.plugin.createBookFromAudible(this.url,e,this.status,this.rating),this.close()}catch(e){console.error(e),new u.Notice(`Failed: ${e?.message??String(e)}`)}})}),new u.Setting(r).addButton(t=>{t.setButtonText("Cancel").onClick(()=>this.close())})}onClose(){this.contentEl.empty()}},N=class extends u.Modal{constructor(r,t){super(r);this.url="";this.libraryId="";this.rating="";this.plugin=t,this.libraryId=t.settings.activeLibraryId,this.rating=String(t.settings.defaultRatingNumber)}async onOpen(){let{contentEl:r}=this;r.empty(),r.createEl("h2",{text:"Create Author from Audible"}),new u.Setting(r).setName("Audible URL").setDesc("Paste the Audible author page URL").addText(t=>{t.setPlaceholder("https://www.audible.com/author/...").onChange(e=>this.url=e.trim()),t.inputEl.style.width="100%"}),new u.Setting(r).setName("Library").addDropdown(t=>{this.plugin.settings.libraries.forEach(e=>{t.addOption(e.id,e.name)}),t.setValue(this.libraryId),t.onChange(e=>this.libraryId=e)}),new u.Setting(r).setName("Rating").addText(t=>{t.setValue(this.rating).onChange(e=>this.rating=e.trim()),t.inputEl.style.width="100%"}),new u.Setting(r).addButton(t=>{t.setButtonText("Create").setCta().onClick(async()=>{try{if(!this.url){new u.Notice("Please enter an Audible URL.");return}let e=this.plugin.settings.libraries.find(a=>a.id===this.libraryId);if(!e){new u.Notice("Selected library not found.");return}await this.plugin.createAuthorFromAudible(this.url,e,this.rating),this.close()}catch(e){console.error(e),new u.Notice(`Failed: ${e?.message??String(e)}`)}})}),new u.Setting(r).addButton(t=>{t.setButtonText("Cancel").onClick(()=>this.close())})}onClose(){this.contentEl.empty()}},v=class extends u.Plugin{async onload(){console.log(`Audible Library Creator v${this.manifest.version} loading...`),await this.loadSettings(),this.addCommand({id:"create-book-from-audible",name:"Create Book from Audible",callback:()=>new P(this.app,this).open()}),this.addCommand({id:"create-author-from-audible",name:"Create Author from Audible",callback:()=>new N(this.app,this).open()}),this.addSettingTab(new T(this.app,this))}async loadSettings(){this.settings=Object.assign({},R,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async createBookFromAudible(s,r,t,e){let a=this.settings,o=b(r.booksRoot);this.app.vault.getAbstractFileByPath(o)||await this.app.vault.createFolder(o),new u.Notice("Fetching Audible page\u2026");let c=await ee(s,r,a,t,e),g=await B(this.app,a.bookTemplatePath),h=q(g,c),f=b(`${o}/${c.title}.md`),l=this.app.vault.getAbstractFileByPath(f);if(l&&l instanceof u.TFile){if(!a.overwriteIfExists){new u.Notice(`File exists: ${f}`),a.openCreatedFile&&await this.app.workspace.getLeaf(!1).openFile(l);return}await this.app.vault.modify(l,h),new u.Notice(`Updated: ${c.title}`)}else await this.app.vault.create(f,h),new u.Notice(`Created: ${c.title}`);if(a.openCreatedFile){let y=this.app.vault.getAbstractFileByPath(f);y&&y instanceof u.TFile&&await this.app.workspace.getLeaf(!1).openFile(y)}}async createAuthorFromAudible(s,r,t){let e=this.settings,a=b(r.authorsFolder);this.app.vault.getAbstractFileByPath(a)||await this.app.vault.createFolder(a),new u.Notice("Fetching Audible author page\u2026");let i=await te(s,r,e,t),c=await B(this.app,e.authorTemplatePath),g=q(c,i),h=b(`${a}/${i.author}.md`),f=this.app.vault.getAbstractFileByPath(h);if(f&&f instanceof u.TFile){if(!e.overwriteIfExists){new u.Notice(`File exists: ${h}`);return}await this.app.vault.modify(f,g),new u.Notice(`Updated Author: ${i.author}`)}else await this.app.vault.create(h,g),new u.Notice(`Created Author: ${i.author}`);if(e.openCreatedFile){let l=this.app.vault.getAbstractFileByPath(h);l&&l instanceof u.TFile&&await this.app.workspace.getLeaf(!1).openFile(l)}}};
